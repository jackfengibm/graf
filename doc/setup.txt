###
# Setup Script
###
rails new graf
cd graf
git add .
git commit -a -m "Initial Add"

git remote remove gerrit
git remote remove origin
git remote add origin ssh://git@github.rtp.raleigh.ibm.com/anderslj-us/graf.git
git fetch
git branch --set-upstream-to=origin/master master


# octkit has a type field for user or org
rails g scaffold Org git_id:integer login:string name:string org_type:string date_created:date date_updated:date
rails g scaffold Repo org:references git_id:integer name:string full_name:string fork:boolean date_created:date date_updated:date date_pushed:date
rails g scaffold PullRequest repo:references user:references git_id:integer pr_number:integer body:text title:string state:string date_created:date date_closed:date date_updated:date date_merged:date
rails g scaffold User company:references git_id:integer login:string name:string location:string email:string date_created:date date_updated:date
rails g scaffold Commit repo:references user:references sha:string message:text date_created:date created_at:datetime updated_at:datetime
rails g scaffold Company name:string
rails g scaffold GithubLoad  load_start_time:datetime load_complete_time:datetime initial_load:boolean
rails g scaffold GithubLoadMsg github_load:references msg:text log_level:integer log_date:datetime

rails g model graf_user email:string password_digest:string
rails g controller graf_users

###
# Tips
###
Get delta github data: https://coderwall.com/p/hu2n4g

How to delete all database data: rake db:schema:load

If you are changing text that is inserted into a javascript.js.erb file with no other changed (e.g. changing one of the constants.js file), then run the following for the changes to be picked up = rake tmp:clear


###
# MYSQL
###
Get all users in the DB:
SELECT User, Host, Password FROM mysql.user;

CREATE DATABASE graf_db CHARACTER SET utf8 COLLATE utf8_general_ci;
GRANT ALL PRIVILEGES ON graf_db.* TO 'graf_user'@'localhost' IDENTIFIED BY 'time4fun';

Delete all database tables
--------
DROP TABLE companies;
DROP TABLE github_load_msgs;
DROP TABLE github_loads;
DROP TABLE pull_requests;
DROP TABLE repos;
DROP TABLE schema_migrations;
DROP TABLE users;
DROP TABLE orgs;
DROP TABLE commits;
DROP TABLE commits_users;


###
# Deploying to BlueMix
###
# Setup the database



###
# Upgrading on BlueMix with DB Changes
###
cf delete graf-mongo
cf create-service mysql 300 graf-mongo-db
cf push graf-mongo
http://graf-mongo.stage1.ng.bluemix.net/info
cf delete graf-mongo
cf push -c 'bundle exec rake db:create db:migrate' graf-mongo
cf delete graf-mongo
cf push graf-mongo
cf push graf-mongo



###
# Old Info
###
cf push --command 'bundle exec rails s'

{
   "mysql-5.5": [
      {
         "name": "graf-db",
         "credentials": {
            "name": "d6e8e1188b2124bc7b67fdefa63b8c980",
            "hostname": "10.0.116.62",
            "host": "10.0.116.62",
            "port": 3307,
            "user": "uJ4LJCgf7xsGT",
            "username": "uJ4LJCgf7xsGT",
            "password": "pZDbbwCIZUacr",
            "uri": "mysql://uJ4LJCgf7xsGT:pZDbbwCIZUacr@10.0.116.62:3307/d6e8e1188b2124bc7b67fdefa63b8c980"
         }
      }
   ]
}

# Prod DB
mysql -h 10.0.116.62 -u uJ4LJCgf7xsGT -P 3307 d6e8e1188b2124bc7b67fdefa63b8c980 -p pZDbbwCIZUacr
Database Info: {"adapter"=>"mysql2", "database"=>"d353ee969c03246cdaf60dd94dccd09af", "username"=>"uEOx1e3hFVrzb", "password"=>"pPJfO4iqMs297", "host"=>"10.0.116.153", "port"=>3307}

