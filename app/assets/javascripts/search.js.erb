DATE_PICKER_OPTIONS = {
    showOn: "button",
    buttonImage: "<%= image_path "calendar.png" %>",
    buttonImageOnly: true
  };

//
// Search Criteria Box Functions
//
function initializeSearchCriteria() {
  // Initialize the Filters
  jQuery.each(FILTERS, function(filterName, filterDetails) {
    //alert(filterDetails.multiselect);
    $("#" + filterName + "_filter").change(function () {
      filterUpdate()
    });
  });

  $("#metric_filter").change(function () {
    filterUpdate()
  });

  $("#group_by_filter").change(function () {
    filterUpdate()
  });

  $("#clear_search_criteria_button").click(function () {
    clearSearchCriteria();
  });

  //
  // Setup the date pickers
  //
  $(function() {
    $( "#start_date_filter" ).datepicker(DATE_PICKER_OPTIONS);
  });

  $(function() {
    $( "#end_date_filter" ).datepicker(DATE_PICKER_OPTIONS);
  });
}

function loadLocalStorage() {
  // Load and parse local storage
  var values = window.localStorage.getItem('vals');
  values = jQuery.parseJSON(values);
  for (v in values){
    $("#" + toUnderscore(v) + "_filter").val(values[v]);
  }
}

function sanitizeSearchValue(input) {
  if (input == null) {
    var arr = new Array();
    arr[0] = "";
    return arr;
  }
  else {
    return input;
  }
}

function createSearchCriteriaJSON() {
  values = {}
  alert(JSON.stringify(METRICS));
  alert(METRICS.metrics[$("#metric_filter").val()].base_metric);
  filters = METRICS.base_metrics[METRICS.metrics[$("#metric_filter").val()].base_metric].filters
  $.each(filters, function(index, filterName) {
    values[filterName] = sanitizeSearchValue($("#" + filterName + "_filter").val())
  });

   // = {
   //        month: $("#month_filter"),
   //        quarter: sanitizeSearchValue($("#quarter_filter").val()),
   //        year: sanitizeSearchValue($("#year_filter").val()),
   //        start_date: ($("#start_date_filter").val()),
   //        end_date: ($("#end_date_filter").val()),
   //        repo: sanitizeSearchValue($("#repo_filter").val()),
   //        state: sanitizeSearchValue($("#state_filter").val()),
   //        company: sanitizeSearchValue($("#company_filter").val()),
   //        user: sanitizeSearchValue($("#user_filter").val()),
   //        name: sanitizeSearchValue($("#name_filter").val()),
   //        org: sanitizeSearchValue($("#org_filter").val())
   //      };

  return values;
}


function clearSearchCriteria() {
  
  // Clear all the dropdowns
  // for ( id in whereDropDownIds ) {
  //   $("#" + whereDropDownIds[id]).multiselect("uncheckAll");
  // }
  $("select").multiselect("uncheckAll");

  // Clear the date range
  $("#start_date_filter").val("");
  $("#end_date_filter").val("");

  // Update chart now that values have been reset
  filterUpdate();
}