//
// Search Criteria Box Functions
//
function initializeSearchCriteria() {
  $("#metric_filter").change(function () {
    filterUpdate()
  });

  $("#group_by_filter").change(function () {
    filterUpdate()
  });

  $("#month_filter").change(function () {
    filterUpdate()
  });

  $("#quarter_filter").change(function () {
    filterUpdate()
  });

  $("#year_filter").change(function () {
    filterUpdate()
  });

  $("#repo_filter").change(function () {
    filterUpdate()
  });

  $("#state_filter").change(function () {
    filterUpdate()
  });

  $("#company_filter").change(function () {
    filterUpdate()
  });

  $("#user_filter").change(function () {
    filterUpdate()
  });

  $("#name_filter").change(function () {
    filterUpdate()
  });

  $("#org_filter").change(function () {
    filterUpdate()
  });

  $("#start_date_filter").change(function () {
    filterUpdate()
  });

  $("#end_date_filter").change(function () {
    filterUpdate()
  });

  $("#clear_search_criteria_button").click(function () {
    clearSearchCriteria();
  });

  $(function() {
    $( "#start_date_filter" ).datepicker({
      showOn: "button",
      buttonImage: "<%= image_path "calendar.png" %>",
      buttonImageOnly: true
    });
  });

  $(function() {
    $( "#end_date_filter" ).datepicker({
      showOn: "button",
      buttonImage: "<%= image_path "calendar.png" %>",
      buttonImageOnly: true
    });
  });
}

function loadLocalStorage() {
  // Load and parse local storage
  var values = window.localStorage.getItem('vals');
  values = jQuery.parseJSON(values);
  for (v in values){
    $("#" + toUnderscore(v) + "_filter").val(values[v]);
  }
}

function sanitizeSearchValue(input) {
  if (input == null) {
    var arr = new Array();
    arr[0] = ""
    return arr
  }
  else {
    return input  
  }
}

function createSearchCriteriaJSON() {
  console.log("MONTH" + $("#month_filter").val())
  console.log("CLEAN MONTH" + sanitizeSearchValue($("#month_filter").val()))
  
  values = {
          month: sanitizeSearchValue($("#month_filter").val()),
          quarter: sanitizeSearchValue($("#quarter_filter").val()),
          year: sanitizeSearchValue($("#year_filter").val()),
          start_date: ($("#start_date_filter").val()),
          end_date: ($("#end_date_filter").val()),
          repo: sanitizeSearchValue($("#repo_filter").val()),
          state: sanitizeSearchValue($("#state_filter").val()),
          company: sanitizeSearchValue($("#company_filter").val()),
          user: sanitizeSearchValue($("#user_filter").val()),
          name: sanitizeSearchValue($("#name_filter").val()),
          org: sanitizeSearchValue($("#org_filter").val())
        };
  //console.log("Values");      
  //console.log(values);
  // for (i in values) {
  //   id = "#" + i + "_filter";
  //   console.log($(id).val())
  //   console.log(typeof $(id).val())
  //   if ( typeof $(id).val() == null) {      
  //     $(id).val("");
  //   }
  console.log("Values");      
  console.log(values);
  //}

  return values
}


function clearSearchCriteria() {
  whereDropDownIds = ["month_filter", 
                      "quarter_filter", 
                      "year_filter", 
                      "repo_filter", 
                      "state_filter", 
                      "company_filter", 
                      "user_filter",
                      "name_filter"];

  // Clear all the dropdowns
  for ( id in whereDropDownIds ) {
    $("#" + whereDropDownIds[id]).val("");
  }

  // Clear the date range
  $("#start_date_filter").val("");
  $("#end_date_filter").val("");

  // Update chart now that values have been reset
  filterUpdate();
}